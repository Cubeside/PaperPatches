From 3af7f5262c7a884f233626b7b6b9d02dc4a3b86d Mon Sep 17 00:00:00 2001
From: Brokkonaut <hannos17@gmx.de>
Date: Thu, 10 Mar 2022 06:29:33 +0100
Subject: [PATCH] Fix shulker dupe

---
 .../java/net/minecraft/world/item/ItemStack.java  | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/src/main/java/net/minecraft/world/item/ItemStack.java b/src/main/java/net/minecraft/world/item/ItemStack.java
index dc4639f90..bbd2c8844 100644
--- a/src/main/java/net/minecraft/world/item/ItemStack.java
+++ b/src/main/java/net/minecraft/world/item/ItemStack.java
@@ -322,6 +322,21 @@ public final class ItemStack {
         } else {
             // CraftBukkit start - handle all block place event logic here
             CompoundTag oldData = this.getTagClone();
+            // Brokko start
+            if (oldData != null && oldData.contains("BlockEntityTag")) {
+                CompoundTag oldDataEntityTag = oldData.getCompound("BlockEntityTag");
+                if(oldDataEntityTag.contains("id", 8)) {
+                    String id = oldDataEntityTag.getString("id");
+                    if (id.equals("shulker_box")) {
+                        oldDataEntityTag.putString("id", "minecraft:shulker_box");
+                    } else if (id.equals("banner")) {
+                        oldDataEntityTag.putString("id", "minecraft:banner");
+                    } else if (id.equals("beehive")) {
+                        oldDataEntityTag.putString("id", "minecraft:beehive");
+                    }
+                }
+            }
+            // Brokko end
             int oldCount = this.getCount();
             ServerLevel world = (ServerLevel) itemactioncontext.getLevel();
 
-- 
2.32.0.windows.1

