From b657ab919e9f8f7538275fac29f8f1f1c90f1b8c Mon Sep 17 00:00:00 2001
From: Brokkonaut <hannos17@gmx.de>
Date: Wed, 22 Jun 2022 02:16:09 +0200
Subject: [PATCH] Call PlayerInteractEvent/EntityInteractEvent when a player or
 entity walks on a sculk shrieker or sculk sensor

---
 .../world/level/block/SculkSensorBlock.java         | 13 +++++++++++++
 .../world/level/block/SculkShriekerBlock.java       |  2 +-
 2 files changed, 14 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/world/level/block/SculkSensorBlock.java b/src/main/java/net/minecraft/world/level/block/SculkSensorBlock.java
index ec00dc5bc..16b7fde30 100644
--- a/src/main/java/net/minecraft/world/level/block/SculkSensorBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/SculkSensorBlock.java
@@ -141,6 +141,19 @@ public class SculkSensorBlock extends BaseEntityBlock implements SimpleWaterlogg
         if (!world.isClientSide() && SculkSensorBlock.canActivate(state) && entity.getType() != EntityType.WARDEN) {
             BlockEntity tileentity = world.getBlockEntity(pos);
 
+            // Brokko start - Call event
+            if (entity instanceof Player) {
+                if (org.bukkit.craftbukkit.event.CraftEventFactory.callPlayerInteractEvent((Player) entity, org.bukkit.event.block.Action.PHYSICAL, pos, null, null, null).isCancelled()) {
+                    return;
+                }
+            } else {
+                org.bukkit.event.entity.EntityInteractEvent event = new org.bukkit.event.entity.EntityInteractEvent(entity.getBukkitEntity(), world.getWorld().getBlockAt(pos.getX(), pos.getY(), pos.getZ()));
+                org.bukkit.Bukkit.getPluginManager().callEvent(event);
+                if (event.isCancelled()) {
+                    return;
+                }
+            }
+            // Brokko end
             if (tileentity instanceof SculkSensorBlockEntity) {
                 SculkSensorBlockEntity sculksensorblockentity = (SculkSensorBlockEntity) tileentity;
 
diff --git a/src/main/java/net/minecraft/world/level/block/SculkShriekerBlock.java b/src/main/java/net/minecraft/world/level/block/SculkShriekerBlock.java
index 3626f84c6..3280f6913 100644
--- a/src/main/java/net/minecraft/world/level/block/SculkShriekerBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/SculkShriekerBlock.java
@@ -55,7 +55,7 @@ public class SculkShriekerBlock extends BaseEntityBlock implements SimpleWaterlo
             ServerLevel worldserver = (ServerLevel) world;
             ServerPlayer entityplayer = SculkShriekerBlockEntity.tryGetPlayer(entity);
 
-            if (entityplayer != null) {
+            if (entityplayer != null && !org.bukkit.craftbukkit.event.CraftEventFactory.callPlayerInteractEvent(entityplayer, org.bukkit.event.block.Action.PHYSICAL, pos, null, null, null).isCancelled()) { // Brokko - call PlayerInteractEvent
                 worldserver.getBlockEntity(pos, BlockEntityType.SCULK_SHRIEKER).ifPresent((sculkshriekerblockentity) -> {
                     sculkshriekerblockentity.tryShriek(worldserver, entityplayer);
                 });
-- 
2.32.0.windows.1

